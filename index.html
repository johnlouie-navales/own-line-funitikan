<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OWN-LINE FUNITIKAN</title>
    <script src="assets/js/vue.global.js"></script>
    <script src="assets/js/tailwind.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body, h1, h2, h3, p, button, div { font-family: 'Fredoka', sans-serif; }
        [v-cloak] { display: none; }
    </style>
</head>
<body class="bg-gray-900 min-h-screen m-0 overflow-hidden font-sans">
<div id="app" class="w-full h-screen" v-cloak>
    <div v-if="mode === 'login'" class="fixed inset-0 w-full h-full bg-slate-900 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-3xl shadow-2xl p-8 w-full max-w-md text-center border-4 border-blue-500 animate-fade-in relative">

            <div class="text-6xl mb-4">üè´</div>
            <h1 class="text-3xl font-bold text-blue-900 mb-2 font-[Fredoka]">OWN-LINE FUNITIKAN</h1>
            <p class="text-gray-500 mb-8">Mag-login para simulan ang pag-aaral.</p>

            <div class="space-y-4">
                <div class="text-left">
                    <label class="block text-gray-700 font-bold mb-2 text-sm uppercase tracking-wide">Pangalan ng Estudyante:</label>
                    <input v-model="inputUsername" @keyup.enter="login" type="text" placeholder="Halimbawa: Juan" class="w-full px-4 py-3 rounded-xl border-2 border-gray-300 focus:border-blue-500 focus:outline-none text-lg transition">
                </div>

                <button @click="login" :disabled="!inputUsername" class="w-full bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold py-4 rounded-xl shadow-lg transform transition active:scale-95 text-lg">
                    Pumasok (Login) &rarr;
                </button>
            </div>
        </div>
    </div>

    <div v-if="mode === 'story' && !isGameFinished" class="relative w-full h-full bg-black select-none overflow-hidden">
        <div v-if="currentScene" class="absolute inset-0 z-0 cursor-pointer" @click="nextScene">
            <img
                :src="currentScene.image"
                alt="Story Scene"
                class="w-full h-full object-contain md:object-cover transition-all duration-500 ease-in-out"
            >
            <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-transparent to-black/40 pointer-events-none"></div>
        </div>
        <div class="absolute top-0 left-0 w-full p-4 z-20 flex justify-between items-start md:items-center pointer-events-none">
            <button
                @click="prevScene($event)"
                :disabled="currentSceneIndex === 0"
                class="pointer-events-auto group bg-gray-900/40 hover:bg-gray-900/60 text-white rounded-full p-3 transition border border-white/10 backdrop-blur-xl shadow-lg disabled:opacity-30 disabled:cursor-not-allowed"
                title="Bumalik (Go Back)"
            >
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 md:h-6 md:w-6 group-hover:-translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
            </button>
            <div class="mx-2 md:mx-0 flex-1 flex justify-center">
                <div class="bg-gray-900/40 backdrop-blur-xl border border-white/10 px-6 py-2 rounded-2xl shadow-2xl text-center">
                    <h1 class="text-white font-bold text-base md:text-xl tracking-widest drop-shadow-sm font-[Fredoka] uppercase">
                        {{ currentStory.title }}
                    </h1>
                </div>
            </div>
            <div class="hidden md:block bg-gray-900/40 text-gray-300 px-4 py-1.5 rounded-full border border-white/10 backdrop-blur-xl text-xs font-bold shadow-lg">
                SCENE {{ currentSceneIndex + 1 }} / {{ currentStory.scenes.length }}
            </div>
        </div>
        <div class="absolute bottom-0 w-full p-4 md:p-8 z-10 flex justify-center pointer-events-none">
            <div class="bg-white-900/50 backdrop-blur-xl border border-white/10 p-6 md:p-8 rounded-[1.5rem] shadow-2xl max-w-4xl w-full text-white pointer-events-auto animate-fade-in relative transition-all hover:bg-gray-900/70">
                <div class="absolute -top-5 left-6 md:left-8">
                    <div class="bg-gradient-to-r from-yellow-400 to-orange-500 text-blue-900 font-extrabold px-4 py-1.5 rounded-xl shadow-[0_3px_0_rgb(180,83,9)] border-2 border-white text-base md:text-lg tracking-wider">
                        {{ currentScene ? (currentScene.speaker || 'Narrator') : '...' }}
                    </div>
                </div>
                <p class="text-lg md:text-2xl leading-relaxed mt-2 font-light text-gray-100 font-[Fredoka] text-justify md:text-left drop-shadow-md">
                    {{ currentScene ? currentScene.text : 'Loading...' }}
                </p>
                <div class="mt-3 text-right">
                    <span class="inline-flex items-center text-xs text-blue-300 font-bold uppercase tracking-widest animate-pulse cursor-pointer hover:text-white transition-colors" @click="nextScene">
                        I-click para ituloy
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                        </svg>
                    </span>
                </div>
            </div>
        </div>
    </div>
    <div v-else-if="mode === 'game' && !isGameFinished" class="w-full h-full bg-slate-900 overflow-y-auto">
        <div class="min-h-screen flex items-center justify-center p-4">
            <div class="bg-white rounded-3xl shadow-2xl overflow-hidden border-4 border-blue-500 w-full max-w-6xl">
                <div class="bg-blue-600 p-6 text-center shadow-md z-10 relative">
                    <h1 class="text-3xl md:text-4xl font-bold text-white drop-shadow-md font-[Fredoka] tracking-wider">
                        {{ currentStory.title }}
                    </h1>
                </div>
                <div class="p-6 md:p-8">
                    <div class="bg-yellow-50 border-l-8 border-yellow-400 p-4 mb-8 rounded-r-xl shadow-sm flex flex-col md:flex-row justify-between items-center gap-4">
                        <p class="text-yellow-800 text-lg flex items-center gap-3">
                            <span class="text-2xl">üí°</span>
                            <span><strong>Panuto:</strong> {{ currentStory.gameInstructions }}</span>
                        </p>

                        <div class="bg-white px-6 py-2 rounded-full shadow-md border-2 border-gray-200 flex items-center gap-3 min-w-[160px] justify-center">
                            <span class="text-2xl">‚è≥</span>
                            <span class="text-3xl font-bold font-[Fredoka] tracking-widest" :class="timerColor">
                                {{ formattedTime }}
                             </span>
                        </div>
                    </div>
                    <div v-if="currentStory.gameImage" class="flex flex-col items-center w-full animate-fade-in py-10">
                        <div class="bg-white p-2 rounded-xl border-4 border-dashed border-gray-300 mb-8 shadow-xl transform rotate-1 hover:rotate-0 transition-transform duration-500">
                            <img :src="currentStory.gameImage" alt="Game Preview" class="max-w-full h-auto rounded-lg max-h-[400px]">
                        </div>
                        <button @click="forceNextStory" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-12 rounded-full shadow-lg transform transition hover:scale-105 hover:shadow-2xl text-lg flex items-center gap-2">
                            Tumuloy sa Susunod na Kwento <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                        </button>
                    </div>
                    <div v-else class="flex flex-col lg:flex-row gap-8 items-start justify-center">
                        <div class="flex-1 w-full flex flex-col items-center">
                            <div class="bg-gray-800 p-4 rounded-2xl shadow-2xl border-4 border-gray-700">
                                <div class="grid gap-1.5" :style="{ gridTemplateColumns: `repeat(${gridSize}, minmax(0, 1fr))` }">
                                    <div v-for="(cell, index) in flatGrid"
                                         :key="index"
                                         @click="toggleCell(index)"
                                         class="w-10 h-10 md:w-12 md:h-12 flex items-center justify-center font-bold text-xl rounded-lg cursor-pointer transition-all duration-200 select-none shadow-sm hover:scale-110"
                                         :class="getCellClasses(index)">
                                        {{ cell }}
                                    </div>
                                </div>
                            </div>
                            <div class="flex flex-col items-center space-y-4 w-full mt-6 max-w-lg">
                                <div class="bg-blue-50 border-2 border-blue-200 px-8 py-3 rounded-2xl shadow-inner w-full text-center">
                                    <span class="text-blue-400 uppercase text-xs font-bold tracking-widest block mb-1">Napiling Letra</span>
                                    <span class="text-3xl font-bold text-blue-700 tracking-[0.2em] min-h-[40px] block drop-shadow-sm">
                                        {{ currentSelectionString || '...' }}
                                    </span>
                                </div>
                                <div class="h-10 flex items-center justify-center w-full">
                                    <div v-if="feedbackMessage"
                                         class="px-6 py-2 rounded-full font-bold text-white shadow-md animate-bounce"
                                         :class="{'bg-red-500': feedbackColor === 'red', 'bg-green-500': feedbackColor === 'green', 'bg-orange-400': feedbackColor === 'orange'}">
                                        {{ feedbackMessage }}
                                    </div>
                                </div>
                                <div class="flex gap-4 w-full justify-center">
                                    <button @click="clearSelection" class="bg-gray-200 hover:bg-gray-300 text-gray-600 font-bold py-3 px-8 rounded-xl transition shadow-sm border border-gray-300 flex items-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                                        Burahin
                                    </button>
                                    <button @click="checkAnswer" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-10 rounded-xl shadow-[0_4px_0_rgb(21,128,61)] active:shadow-none active:translate-y-[4px] transform transition flex items-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                                        Ipasa (Submit)
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="w-full lg:w-1/3 flex flex-col gap-4">
                            <div class="bg-blue-50 p-6 rounded-3xl border border-blue-100 shadow-lg h-full">
                                <h3 class="text-xl font-bold text-blue-800 mb-6 flex items-center gap-2 border-b border-blue-200 pb-3">
                                    <span class="text-2xl">üîç</span> Mga Hinahanap:
                                </h3>
                                <div class="grid grid-cols-1 gap-3">
                                    <div v-for="(clue, key) in currentStory.clues" :key="key"
                                         class="p-4 rounded-xl border-2 transition-all duration-300 relative overflow-hidden group"
                                         :class="solvedWords.includes(key) ? 'bg-green-100 border-green-400 text-green-800 opacity-80' : 'bg-white border-blue-100 text-gray-600 hover:border-blue-300'">
                                        <div v-if="solvedWords.includes(key)" class="absolute right-[-10px] bottom-[-10px] opacity-20 pointer-events-none">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-green-600" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                                        </div>
                                        <div class="relative z-10">
                                            <div class="flex justify-between items-center mb-1">
                                                <span v-if="!solvedWords.includes(key)" class="font-bold text-blue-900 text-lg group-hover:text-blue-600 transition-colors">???</span>
                                                <span v-else class="font-bold text-green-700 text-lg">{{ key }}</span>
                                                <span v-if="solvedWords.includes(key)" class="bg-green-200 text-green-800 text-xs px-2 py-1 rounded-full font-bold">FOUND</span>
                                            </div>
                                            <p class="text-sm leading-snug" :class="{'line-through opacity-60': solvedWords.includes(key)}">{{ clue }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div v-if="allSolved && mode === 'game'" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                        <div class="bg-white rounded-3xl p-10 max-w-md w-full text-center shadow-2xl transform scale-100 animate-bounce-in relative overflow-hidden">
                            <div class="absolute inset-0 bg-gradient-to-b from-yellow-50 to-white -z-10"></div>
                            <div class="text-7xl mb-6 animate-pulse">üéâ</div>
                            <h2 class="text-4xl font-bold text-green-600 mb-2 font-[Fredoka]">Mahusay!</h2>
                            <p class="text-gray-600 mb-10 text-lg">Natapos mo ang laro para sa kwentong ito.</p>
                            <button @click="nextStory" class="bg-blue-600 hover:bg-blue-700 text-white text-xl font-bold py-4 px-10 rounded-full shadow-xl w-full transition transform hover:scale-105 active:scale-95">
                                Susunod na Kwento &rarr;
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div v-if="isGameFinished" class="w-full h-full bg-slate-900 flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl shadow-2xl p-10 max-w-2xl w-full text-center animate-bounce-in border-4 border-blue-500">
            <div class="mb-6"><span class="text-8xl">üèÜ</span></div>
            <h2 class="text-4xl font-bold text-blue-900 mb-4">Binabati kita!</h2>
            <p class="text-xl text-gray-600 mb-8">Natapos mo na ang lahat ng kwento at laro sa<br><strong>OWN-LINE FUNITIKAN</strong>.</p>
            <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-8 text-left max-w-md mx-auto rounded">
                <p class="font-bold">Aral na Natutunan:</p>
                <ul class="list-disc list-inside mt-2">
                    <li>Huwag magtiwala sa hindi kakilala (Kuting)</li>
                    <li>Huwag magnakaw (Kalabaw)</li>
                    <li>Maging maingat sa mapagpanggap (Ahas)</li>
                </ul>
            </div>
            <button @click="restartWholeGame" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-10 rounded-full shadow-lg transform transition hover:scale-105">üîÑ Maglaro Ulit</button>
        </div>
    </div>
    <div v-if="isTimeUp" class="fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center z-[60] p-4">
        <div class="bg-white rounded-3xl p-10 max-w-md w-full text-center shadow-2xl animate-bounce-in border-4 border-red-500">
            <div class="text-7xl mb-6">‚è∞</div>
            <h2 class="text-4xl font-bold text-red-600 mb-2 font-[Fredoka]">Naubos ang Oras!</h2>
            <p class="text-gray-600 mb-8 text-lg">Huwag sumuko! Kaya mo yan.</p>

            <button @click="retryLevel" class="bg-blue-600 hover:bg-blue-700 text-white text-xl font-bold py-4 px-10 rounded-full shadow-xl w-full transition transform hover:scale-105 active:scale-95">
                üîÑ Subukan Ulit (Retry)
            </button>
        </div>
    </div>
</div>

<script src="data/stories.js"></script>
<script src="assets/js/api.js"></script>
<script src="assets/js/app.js"></script>
</body>
</html>